<link rel="stylesheet" href="http://openlayers.org/en/v3.17.1/css/ol.css" type="text/css">
<script src="http://openlayers.org/en/v3.17.1/build/ol.js" type="text/javascript"></script>
<script type="text/javascript">
  
  document.addEventListener("DOMContentLoaded", function(event) {

  	document.getElementById('the_map').setAttribute("style", "height:600px");

    var layers = [];
    var zoom = {{ resource.zoom }};
    var center_x = {{ resource.center_x }};
    var center_y = {{ resource.center_y }};
    var center = [center_x, center_y];

    var config = {{ config|safe }};
    var config_layers = config['map']['layers']
    for (layer in config_layers) {
        if (config_layers[layer]['title'] == 'OpenStreetMap') {
            if (config_layers[layer]['visibility'] == true) {
                layers.push(new ol.layer.Tile({
                    source: new ol.source.OSM()
                }));
            }
            break;
        }
    }
    {% for layer in resource.layers %}
        {% if layer.ows_url != None %}
        layers.push(new ol.layer.Tile({
                source: new ol.source.TileWMS({
                    url: '{{ layer.ows_url }}',
                    params: {'LAYERS': '{{ layer.name }}'}
                })
            })
        );
        {% endif %}
    {% endfor %}
    	
	var map = new ol.Map({
    	layers: layers,
      	target: 'the_map',
      	view: new ol.View({
        	center: center,
        	zoom: zoom
        })	
	});
  });

</script>
